apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Values.fullname }}-config
  labels:
    app.kubernetes.io/name: {{ .Values.name }}
    app.kubernetes.io/instance: {{ .Release.Name }}
    helm.sh/chart: {{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}
    app.kubernetes.io/managed-by: {{ .Release.Service }}
data:
  config.yaml: |
    mode: {{ .Values.config.mode | quote }}
    poolId: {{ .Values.config.poolId | quote }}
    ticker: {{ .Values.config.ticker | quote }}
    poolName: {{ .Values.config.poolName | quote }}
    nodeAddress:
      host1: {{ .Values.config.nodeAddress.host1 | quote }}
      {{- if .Values.config.nodeAddress.host2 }}
      host2: {{ .Values.config.nodeAddress.host2 | quote }}
      {{- end }}
      {{- if .Values.config.nodeAddress.ntcHost }}
      ntcHost: {{ .Values.config.nodeAddress.ntcHost | quote }}
      {{- end }}
    networkMagic: {{ .Values.config.networkMagic | int }}
    telegram:
      enabled: {{ .Values.config.telegram.enabled }}
      channel: {{ .Values.config.telegram.channel | quote }}
      {{- if .Values.config.telegram.allowedUsers }}
      allowedUsers:
        {{- range .Values.config.telegram.allowedUsers }}
        - {{ . }}
        {{- end }}
      {{- end }}
      {{- if .Values.config.telegram.allowedGroups }}
      allowedGroups:
        {{- range .Values.config.telegram.allowedGroups }}
        - {{ . }}
        {{- end }}
      {{- end }}
    twitter:
      enabled: {{ .Values.config.twitter.enabled }}
      api_version: "v2"
    duck:
      media: {{ .Values.config.duck.media | quote }}
      {{- if .Values.config.duck.customUrl }}
      customUrl: {{ .Values.config.duck.customUrl | quote }}
      {{- end }}
    {{- if or .Values.config.leaderlog.enabled .Values.config.leaderlog.vrfKeyValue }}
    leaderlog:
      enabled: true
      {{- if .Values.config.leaderlog.vrfKeyValue }}
      vrfKeyValue: {{ .Values.config.leaderlog.vrfKeyValue | quote }}
      {{- else }}
      vrfKeyPath: {{ .Values.config.leaderlog.vrfKeyPath | quote }}
      {{- end }}
      timezone: {{ .Values.config.leaderlog.timezone | quote }}
      timeFormat: {{ .Values.config.leaderlog.timeFormat | default "12h" | quote }}
      {{- if .Values.config.leaderlog.ntcQueryTimeout }}
      ntcQueryTimeout: {{ .Values.config.leaderlog.ntcQueryTimeout | quote }}
      {{- end }}
    database:
      driver: {{ .Values.config.database.driver | quote }}
      {{- if eq .Values.config.database.driver "sqlite" }}
      path: {{ .Values.config.database.path | quote }}
      {{- else }}
      host: {{ .Values.config.database.host | quote }}
      port: {{ .Values.config.database.port | int }}
      name: {{ .Values.config.database.name | quote }}
      user: {{ .Values.config.database.user | quote }}
      {{- end }}
    {{- end }}
